# Execution Guide for PR #122 Test Suite

## Overview

The automated test script `test-pr122.sh` has been implemented according to the TEST_PLAN.md specifications. This script validates the Kotlin/Java language selection feature for Capacitor plugin generation.

## What Was Implemented

### Core Components

1. **Prerequisite Checks**
   - Validates Node.js, npm, Java, and Git installations
   - Checks environment variables (JAVA_HOME, ANDROID_HOME)
   - Provides clear error messages for missing requirements

2. **PR Setup and Verification**
   - Locates PR code at `../fork-create-capacitor-plugin-pr122-kotlin`
   - Installs dependencies and builds the tool
   - Verifies the `--android-lang` option exists

3. **Plugin Generation**
   - Generates plugins with specified configurations
   - Uses proper entry point: `bin/create-capacitor-plugin`
   - Logs all generation output

4. **Structure Validation**
   - Verifies correct language-specific folders exist
   - Confirms incorrect folders are deleted
   - Validates file extensions (.kt for Kotlin, .java for Java)
   - Checks Gradle dependencies

5. **Build and Test Execution**
   - Runs `npm install` and `npm run build`
   - Executes Gradle builds with tests
   - Captures all output in log files

6. **Test Scenarios** (4 scenarios implemented)
   - Scenario 1: Basic Java Plugin (Regression)
   - Scenario 2: Basic Kotlin Plugin
   - Scenario 3: Complex Package Names (Kotlin)
   - Scenario 4: Simple Package Names (Java)

7. **Reporting**
   - Generates summary report with pass/fail status
   - Lists failed tests with references to logs
   - Saves detailed logs for troubleshooting

## Directory Structure

After running the script:

```
test-create-capacitor-plugin-pr122/
├── test-pr122.sh              # Main test script
├── TEST_PLAN.md               # Test plan document
├── EXECUTION_GUIDE.md         # This file
├── manual-tests/              # ⚠️  Not touched by automation
├── test-results/              # Generated by script
│   ├── test-java-plugin/      # Generated Java plugin
│   ├── test-kotlin-plugin/    # Generated Kotlin plugin
│   ├── advanced-features-plugin/  # Complex package test
│   ├── simple-plugin/         # Simple package test
│   └── logs/                  # Detailed logs
│       ├── pr-build.log
│       ├── test-java-plugin-generation.log
│       ├── test-java-plugin-build.log
│       ├── test-java-plugin-gradle.log
│       └── ... (more logs)
└── reports/                   # Test reports
    └── test-summary.txt       # Final summary
```

## How to Run

### Prerequisites

Ensure you have:
- Node.js >= 18.x
- npm >= 8.x
- Java JDK 21
- Git
- Android SDK (optional, for full builds)

### Step 1: Verify PR Location

The script expects the PR code at:
```
../fork-create-capacitor-plugin-pr122-kotlin
```

Relative to the test directory. Verify this exists:
```bash
ls -la ../fork-create-capacitor-plugin-pr122-kotlin
```

### Step 2: Run the Test Script

```bash
cd /Users/pedrobilro/Desktop/client_projects/outsystems/source_codes/community_ionic_repos/test-create-capacitor-plugin-pr122

./test-pr122.sh
```

### Step 3: Review Results

The script will:
1. Display colored output showing progress
2. Run all test scenarios
3. Generate a summary report at `reports/test-summary.txt`

## What to Expect

### Successful Run

```
================================================================================
PR #122 Automated Test Suite
================================================================================

[INFO] Starting automated tests for Kotlin/Java language selection feature
...
[SUCCESS] All tests completed successfully!
```

### Failed Tests

If tests fail, you'll see:
```
[ERROR] ✗ Scenario failed: Scenario 2: Basic Kotlin Plugin
...
Result: SOME TESTS FAILED ✗
```

Check the logs in `test-results/logs/` for details.

## Troubleshooting

### Common Issues

1. **PR directory not found**
   - Ensure `../fork-create-capacitor-plugin-pr122-kotlin` exists
   - Check the path in the script's `PLUGIN_TOOL_DIR` variable

2. **Build failures**
   - Check `test-results/logs/pr-build.log`
   - Ensure all npm dependencies can be installed

3. **Gradle failures**
   - Check individual plugin Gradle logs
   - Ensure ANDROID_HOME is set correctly
   - Verify JDK 21 is installed

4. **Generation failures**
   - Check generation logs in `test-results/logs/`
   - Verify the PR has the `--android-lang` option

### Debug Mode

To see more verbose output, you can modify the script to keep stderr visible:
```bash
# In test-pr122.sh, temporarily change:
# npm install > "$log_file" 2>&1
# to:
# npm install 2>&1 | tee "$log_file"
```

## Cleaning Up

To clean test results and run again:

```bash
rm -rf test-results/ reports/
./test-pr122.sh
```

**⚠️ Important:** Never delete or modify the `manual-tests/` directory. It's reserved for manual testing.

## Next Steps

After successful test run:

1. Review the test summary in `reports/test-summary.txt`
2. Inspect generated plugins in `test-results/`
3. Manually verify code quality (see TEST_PLAN.md "Manual Verification Checklist")
4. Run additional integration tests if needed
5. Provide feedback to PR author

## Notes

- The script uses proper color coding:
  - Blue: Information
  - Green: Success
  - Yellow: Warnings
  - Red: Errors

- All generated plugins go to `test-results/` directory
- The `manual-tests/` directory is never touched
- Detailed logs are preserved for troubleshooting
- The script exits with code 0 on success, 1 on failure (CI/CD friendly)

## Customization

To add more test scenarios, add to the `main()` function:

```bash
run_test_scenario \
    "Scenario 5: Your Custom Test" \
    "plugin-name" \
    "com.example.package" \
    "ClassName" \
    "kotlin"  # or "java"
```

## Script Features

- ✅ Colored, user-friendly output
- ✅ Comprehensive logging
- ✅ Clear error messages
- ✅ Progress tracking
- ✅ Summary report generation
- ✅ CI/CD compatible (proper exit codes)
- ✅ Respects manual-tests/ directory
- ✅ Uses proper CLI entry point (bin/create-capacitor-plugin)
